\section{Methodology}

We use a sequence of optimization processes based on observation and synthetic data to find the most appropriate \qsvs{} relationship parameters. The proposed process makes it possible to locate the most accurate shear wave velocity range or effective shear wave velocity range to study \qsvs{} relationship for each seismic station. We use the term of effective shear wave velocity range for the range of \vs{} that a traveling wave has been highly influenced from while propagating in the domain, or based on recorded data and optimization process we can extract $Q$ values for that range of \vs{}. The \qsvs{} relationship is defined as a function of shear wave velocity.  A genetic algorithm (GA) is used to search for the best parameters of this relationship.  In simple words, it efficiently searches for those parameters that result in close to target values. Target values can be acquired from synthetic ground motion simulations or actual observations. GA uses a function, which is known as a cost function, to evaluate the proposed parameters. If it provides good results, it keeps them if not it searches for other parameters unless it finds the best solution or meets the termination criteria. The cost function evaluation is based on signals comparison. It is not possible to compare two signals wiggle by wiggle at higher frequencies (\fmaxeq{0.5}). Therefore, the cost function compares some metrics of signals instead of the whole waveforms.  The synthetic signal is generated based on proposed parameters by GA at iteration. Extracting these metrics, for each set of new parameters, requires running a regional scale ground motion simulation. These runs are computationally expensive and time-consuming. To make this process practical under a reasonable time and computational budget, based on many simulation data, we develop surrogates (or meta-models).  The surrogates are artificial neural networks (ANNs) that are trained to accurately estimate the signal metrics based on \qsvs{} relationship input parameters. Fig.~\ref{fig:Figure_1} shows the method's workflow. The workflow includes four main tasks:
\begin{itemize}
        \item \qsvs{} relationships and ground motion simulations 
	\item Preprocessing signals and extracting signals metrics,
	\item Developing surrogates, 
	\item Running the optimization process to search for the best input parameters, and
	\item Locating the effective shear-wave velocity range and choosing data.  
\end{itemize}

 \begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{figures/pdf/Figure_02.pdf}
    \caption{Processing steps {\color{red} working on improving this figure and the caption.}}
    \label{fig:Figure_1}
\end{figure}

In the rest of this section, we go into details of each mentioned tasks.

\input{qsvs_relationships_and_GMS}

\input{signal_metrics}

\input{AM_GMS_ANN}

\input{GA}

\input{Velocity_range}





